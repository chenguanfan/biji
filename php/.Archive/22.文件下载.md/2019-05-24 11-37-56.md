/*
$filename = 'http://192.168.23.242/php_down/index.html';
//$filename = 'http://192.168.23.242/php_down/index.html';
$fp = fopen($filename, 'r');
$str = '';
while(!feof($fp)){
	$str .= fgets($fp);
}
$fp01 = fopen('./files/'.basename($filename),'w');
fwrite($fp01, $str);
fclose($fp);
fclose($fp01);
echo '下载完成!';
*/

$curl = curl_init();
$opt = array(
	CURLOPT_URL => "http://192.168.23.242/php_down/index.html",
	//php获取地址
	CURLOPT_NOBODY => FALSE	,
	//不获取主体内容
	CURLOPT_HEADER => FALSE,
	//获取内容
	CURLOPT_SSL_VERIFYPEER => FALSE,
	//https请求 不验证证书和hosts
	CURLOPT_RETURNTRANSFER => TRUE,
	//获取的信息以文件流的形式返回,而不是直接输出
	CURLOPT_FOLLOWLOCATION => TRUE,
	//如果返回重定向页面,则跟踪重定向
//	CURLOPT_USERAGENT => 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36',//设置客户端信息.
//	CURLOPT_TIMEOUT => 20,/*这个没有什么大的作用*/
);
curl_setopt_array($curl, $opt);
$data = curl_exec($curl);
curl_close($curl);
if($data !== FALSE ){
	echo $data;
}else{
	echo '没有获取到!';
	return;
}

echo '<hr />';

$url = 'http://192.168.23.242/php_down/index.html';
function curl_get_last_url($url){
	$ch = curl_init();
	curl_setopt($ch, CURLOPT_URL, $url);//用php取回的地址
	curl_setopt($ch, CURLOPT_NOBODY, FALSE);//不获取主体内容
	curl_setopt($ch, CURLOPT_HEADER, FALSE);//获取内容
	curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);//https请求 不验证证书和hosts
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);//获取的信息以文件流的形式返回，而不是直接输出
	curl_setopt($ch, CURLOPT_FOLLOWLOCATION, TRUE);//如果返回重定向页面,则跟踪重定向
	curl_setopt($ch, CURLOPT_TIMEOUT, 20);//延时处理:秒数
	$result = curl_exec($ch);
	if($result !== FALSE){
		echo $result;
		$statusCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);//返回状态码
		$last_url =  trim(curl_getinfo($ch,CURLINFO_EFFECTIVE_URL),' /');//获取最后一次URL,就是重定向后的URL
	}else{
		$last_url = FALSE;
	}
	curl_close($ch);
	return $last_url;
	if($last_url == FALSE){
		echo '没有获取到!';
		return;
	}
}